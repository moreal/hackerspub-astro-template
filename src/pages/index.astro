---
import { getAllArticles } from "@/lib/graphql/client";
import { siteConfig } from "@/config";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Navigation from "@/components/Navigation.astro";
import { RelativeTime } from "@/components/RelativeTime";

const articles = await getAllArticles(
  siteConfig.handle,
  siteConfig.minimumVisibility,
);
---

<BaseLayout>
  <header class="mb-12">
    <h1 class="text-4xl font-bold mb-2">{siteConfig.title}</h1>
    <p class="text-gray-600">{siteConfig.description}</p>
    <Navigation class="mt-4 flex gap-4" />
  </header>

  <main>
    <h2 class="text-2xl font-bold mb-6">Articles</h2>
    <div class="space-y-6">
      {
        articles.map((article) => (
          <article class="border-b pb-6">
            <h3 class="text-xl font-semibold mb-2">
              <a
                href={`${import.meta.env.BASE_URL}/posts/${article.publishedYear}/${article.slug}`}
                class="text-blue-600 hover:underline"
              >
                {article.name}
              </a>
            </h3>
            <RelativeTime
              client:load
              datetime={article.published}
              className="text-sm text-gray-500"
            />
            {article.tags.length > 0 && (
              <div class="mt-2 flex flex-wrap gap-2">
                {article.tags.map((tag) => (
                  <a
                    href={`${import.meta.env.BASE_URL}/tag/${tag}`}
                    class="text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded"
                  >
                    #{tag}
                  </a>
                ))}
              </div>
            )}
          </article>
        ))
      }
    </div>
  </main>
</BaseLayout>
