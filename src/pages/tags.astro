---
import { getAllArticles } from "@/lib/graphql/client";
import { siteConfig } from "@/config";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Navigation from "@/components/Navigation.astro";

const articles = await getAllArticles(
  siteConfig.handle,
  siteConfig.minimumVisibility,
);

const tagCounts = new Map<string, number>();
articles.forEach((article) => {
  article.tags.forEach((tag) => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

const sortedTags = Array.from(tagCounts.entries()).sort(([a], [b]) =>
  a.localeCompare(b),
);
---

<BaseLayout title="Tags">
  <header class="mb-8">
    <Navigation class="mb-4 flex gap-4" />
  </header>

  <main>
    <h1 class="text-4xl font-bold mb-8">Tags</h1>

    <div class="flex flex-wrap gap-3">
      {
        sortedTags.map(([tag, count]) => (
          <a
            href={`/tag/${tag}`}
            class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-colors"
          >
            <span class="font-medium">#{tag}</span>
            <span class="text-sm text-gray-600 ml-2">({count})</span>
          </a>
        ))
      }
    </div>
  </main>
</BaseLayout>
